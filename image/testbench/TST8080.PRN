

                ;***********************************************************************
                ; MICROCOSM ASSOCIATES  8080/8085 CPU DIAGNOSTIC VERSION 1.0  (C) 1980
                ;***********************************************************************
                ;
                ;DONATED TO THE "SIG/M" CP/M USER'S GROUP BY:
                ;KELLY SMITH, MICROCOSM ASSOCIATES
                ;3055 WACO AVENUE
                ;SIMI VALLEY, CALIFORNIA, 93065
                ;(805) 527-9321 (MODEM, CP/M-NET (TM))
                ;(805) 527-0518 (VERBAL)
                ;
                ;  Updated by Mike Douglas October, 2012 
                ;
                ;	Added the following tests that were missing:
                ;	   mov c,m
                ;	   mov m,c
                ;	   ana b
                ;
                ;	Fixed the CPUER exit routine which did not display the
                ;	   low byte of the failure address properly.
                ;
                ;	Added display of the Microcosm welcome message
                ;
 0100           	ORG	00100H
                
                ;
 0100 C3B201    	JMP	CPU	;JUMP TO 8080 CPU DIAGNOSTIC
                ;
 0103 4D4943524FWELCOM	DB	'MICROCOSM ASSOCIATES 8080/8085 CPU DIAGNOSTIC',13,10
 0132 2056455253	DB	' VERSION 1.0  (C) 1980',13,10,'$'
                ;
 0005 =         BDOS	EQU	00005H	;BDOS ENTRY TO CP/M
 0000 =         WBOOT	EQU	00000H	;RE-ENTRY TO CP/M WARM BOOT
                ;
                ;
                ;
                ;MESSAGE OUTPUT ROUTINE
                ;
 014B D5        MSG:	PUSH	D	;EXILE D REG.
 014C EB        	XCHG		;SWAP H&L REGS. TO D&E REGS.
 014D 0E09      	MVI	C,9	;LET BDOS KNOW WE WANT TO SEND A MESSAGE
 014F CD0500    	CALL	BDOS
 0152 D1        	POP	D	;BACK FROM EXILE
 0153 C9        	RET
                ;
                ;
                ;
                ;CHARACTER OUTPUT ROUTINE
                ;
 0154 0E02      PCHAR:	MVI	C,2
 0156 CD0500    	CALL	BDOS
 0159 C9        	RET
                ;
                ;
                ;
 015A F5        BYTEO:	PUSH	PSW
 015B CD6A01    	CALL	BYTO1
 015E 5F        	MOV	E,A
 015F CD5401    	CALL	PCHAR
 0162 F1        	POP	PSW
 0163 CD6E01    	CALL	BYTO2
 0166 5F        	MOV	E,A
 0167 C35401    	JMP	PCHAR
 016A 0F        BYTO1:	RRC
 016B 0F        	RRC
 016C 0F        	RRC
 016D 0F        	RRC
 016E E60F      BYTO2:	ANI	0FH
 0170 FE0A      	CPI	0AH
 0172 FA7701    	JM	BYTO3
 0175 C607      	ADI	7
 0177 C630      BYTO3:	ADI	30H
 0179 C9        	RET
                ;
                ;
                ;
                ;************************************************************
                ;           MESSAGE TABLE FOR OPERATIONAL CPU TEST
                ;************************************************************
                ;
 017A 0D0A204350OKCPU:	DB	0DH,0AH,' CPU IS OPERATIONAL$'
                ;
 0190 0D0A204350NGCPU:	DB	0DH,0AH,' CPU HAS FAILED!    ERROR EXIT=$'
                ;
                ;
                ;
                ;************************************************************
                ;                8080/8085 CPU TEST/DIAGNOSTIC
                ;************************************************************
                ;
                ;NOTE: (1) PROGRAM ASSUMES "CALL",AND "LXI SP" INSTRUCTIONS WORK!
                ;
                ;      (2) INSTRUCTIONS NOT TESTED ARE "HLT","DI","EI","RIM","SIM",
                ;          AND "RST 0" THRU "RST 7"
                ;
                ;
                ;
                ;TEST JUMP INSTRUCTIONS AND FLAGS
                ;
 01B2 31BD07    CPU:	LXI	SP,STACK	;SET THE STACK POINTER
 01B5 210301    	LXI	H,WELCOM
 01B8 CD4B01    	CALL	MSG
 01BB E600      	ANI	0	;INITIALIZE A REG. AND CLEAR ALL FLAGS
 01BD CAC301    	JZ	J010	;TEST "JZ"
 01C0 CDA006    	CALL	CPUER
 01C3 D2C901    J010:	JNC	J020	;TEST "JNC"
 01C6 CDA006    	CALL	CPUER
 01C9 EACF01    J020:	JPE	J030	;TEST "JPE"
 01CC CDA006    	CALL	CPUER
 01CF F2D501    J030:	JP	J040	;TEST "JP"
 01D2 CDA006    	CALL	CPUER
 01D5 C2E401    J040:	JNZ	J050	;TEST "JNZ"
 01D8 DAE401    	JC	J050	;TEST "JC"
 01DB E2E401    	JPO	J050	;TEST "JPO"
 01DE FAE401    	JM	J050	;TEST "JM"
 01E1 C3E701    	JMP	J060	;TEST "JMP" (IT'S A LITTLE LATE,BUT WHAT THE HELL!
 01E4 CDA006    J050:	CALL	CPUER
 01E7 C606      J060:	ADI	6	;A=6,C=0,P=1,S=0,Z=0
 01E9 C2EF01    	JNZ	J070	;TEST "JNZ"
 01EC CDA006    	CALL	CPUER
 01EF DAF801    J070:	JC	J080	;TEST "JC"
 01F2 E2F801    	JPO	J080	;TEST "JPO"
 01F5 F2FB01    	JP	J090	;TEST "JP"
 01F8 CDA006    J080:	CALL	CPUER
 01FB C670      J090:	ADI	070H	;A=76H,C=0,P=0,S=0,Z=0
 01FD E20302    	JPO	J100	;TEST "JPO"
 0200 CDA006    	CALL	CPUER
 0203 FA0C02    J100:	JM	J110	;TEST "JM"
 0206 CA0C02    	JZ	J110	;TEST "JZ"
 0209 D20F02    	JNC	J120	;TEST "JNC"
 020C CDA006    J110:	CALL	CPUER
 020F C681      J120:	ADI	081H	;A=F7H,C=0,P=0,S=1,Z=0
 0211 FA1702    	JM	J130	;TEST "JM"
 0214 CDA006    	CALL	CPUER
 0217 CA2002    J130:	JZ	J140	;TEST "JZ"
 021A DA2002    	JC	J140	;TEST "JC"
 021D E22302    	JPO	J150	;TEST "JPO"
 0220 CDA006    J140:	CALL	CPUER
 0223 C6FE      J150:	ADI	0FEH	;A=F5H,C=1,P=1,S=1,Z=0
 0225 DA2B02    	JC	J160	;TEST "JC"
 0228 CDA006    	CALL	CPUER
 022B CA3402    J160:	JZ	J170	;TEST "JZ"
 022E E23402    	JPO	J170	;TEST "JPO"
 0231 FA3702    	JM	AIMM	;TEST "JM"
 0234 CDA006    J170:	CALL	CPUER
                ;
                ;
                ;
                ;TEST ACCUMULATOR IMMEDIATE INSTRUCTIONS
                ;
 0237 FE00      AIMM:	CPI	0	;A=F5H,C=0,Z=0
 0239 DA4F02    	JC	CPIE	;TEST "CPI" FOR RE-SET CARRY
 023C CA4F02    	JZ	CPIE	;TEST "CPI" FOR RE-SET ZERO
 023F FEF5      	CPI	0F5H	;A=F5H,C=0,Z=1
 0241 DA4F02    	JC	CPIE	;TEST "CPI" FOR RE-SET CARRY ("ADI")
 0244 C24F02    	JNZ	CPIE	;TEST "CPI" FOR RE-SET ZERO
 0247 FEFF      	CPI	0FFH	;A=F5H,C=1,Z=0
 0249 CA4F02    	JZ	CPIE	;TEST "CPI" FOR RE-SET ZERO
 024C DA5202    	JC	ACII	;TEST "CPI" FOR SET CARRY
 024F CDA006    CPIE:	CALL	CPUER
 0252 CE0A      ACII:	ACI	00AH	;A=F5H+0AH+CARRY(1)=0,C=1
 0254 CE0A      	ACI	00AH	;A=0+0AH+CARRY(0)=0BH,C=0
 0256 FE0B      	CPI	00BH
 0258 CA5E02    	JZ	SUII	;TEST "ACI"
 025B CDA006    	CALL	CPUER
 025E D60C      SUII:	SUI	00CH	;A=FFH,C=0
 0260 D60F      	SUI	00FH	;A=F0H,C=1
 0262 FEF0      	CPI	0F0H
 0264 CA6A02    	JZ	SBII	;TEST "SUI"
 0267 CDA006    	CALL	CPUER
 026A DEF1      SBII:	SBI	0F1H	;A=F0H-0F1H-CARRY(0)=FFH,C=1
 026C DE0E      	SBI	00EH	;A=FFH-OEH-CARRY(1)=F0H,C=0
 026E FEF0      	CPI	0F0H
 0270 CA7602    	JZ	ANII	;TEST "SBI"
 0273 CDA006    	CALL	CPUER
 0276 E655      ANII:	ANI	055H	;A=F0H<AND>55H=50H,C=0,P=1,S=0,Z=0
 0278 FE50      	CPI	050H
 027A CA8002    	JZ	ORII	;TEST "ANI"
 027D CDA006    	CALL	CPUER
 0280 F63A      ORII:	ORI	03AH	;A=50H<OR>3AH=7AH,C=0,P=0,S=0,Z=0
 0282 FE7A      	CPI	07AH
 0284 CA8A02    	JZ	XRII	;TEST "ORI"
 0287 CDA006    	CALL	CPUER
 028A EE0F      XRII:	XRI	00FH	;A=7AH<XOR>0FH=75H,C=0,P=0,S=0,Z=0
 028C FE75      	CPI	075H
 028E CA9402    	JZ	C010	;TEST "XRI"
 0291 CDA006    	CALL	CPUER
                ;
                ;
                ;
                ;TEST CALLS AND RETURNS
                ;
 0294 E600      C010:	ANI	000H	;A=0,C=0,P=1,S=0,Z=1
 0296 DCA006    	CC	CPUER	;TEST "CC"
 0299 E4A006    	CPO	CPUER	;TEST "CPO"
 029C FCA006    	CM	CPUER	;TEST "CM"
 029F C4A006    	CNZ	CPUER	;TEST "CNZ"
 02A2 FE00      	CPI	000H
 02A4 CAAA02    	JZ	C020	;A=0,C=0,P=0,S=0,Z=1
 02A7 CDA006    	CALL	CPUER
 02AA D677      C020:	SUI	077H	;A=89H,C=1,P=0,S=1,Z=0
 02AC D4A006    	CNC	CPUER	;TEST "CNC"
 02AF ECA006    	CPE	CPUER	;TEST "CPE"
 02B2 F4A006    	CP	CPUER	;TEST "CP"
 02B5 CCA006    	CZ	CPUER	;TEST "CZ"
 02B8 FE89      	CPI	089H
 02BA CAC002    	JZ	C030	;TEST FOR "CALLS" TAKING BRANCH
 02BD CDA006    	CALL	CPUER
 02C0 E6FF      C030:	ANI	0FFH	;SET FLAGS BACK!
 02C2 E4CD02    	CPO	CPOI	;TEST "CPO"
 02C5 FED9      	CPI	0D9H
 02C7 CA2A03    	JZ	MOVI	;TEST "CALL" SEQUENCE SUCCESS
 02CA CDA006    	CALL	CPUER
 02CD E8        CPOI:	RPE		;TEST "RPE"
 02CE C610      	ADI	010H	;A=99H,C=0,P=0,S=1,Z=0
 02D0 ECD902    	CPE	CPEI	;TEST "CPE"
 02D3 C602      	ADI	002H	;A=D9H,C=0,P=0,S=1,Z=0
 02D5 E0        	RPO		;TEST "RPO"
 02D6 CDA006    	CALL	CPUER
 02D9 E0        CPEI:	RPO		;TEST "RPO"
 02DA C620      	ADI	020H	;A=B9H,C=0,P=0,S=1,Z=0
 02DC FCE502    	CM	CMI	;TEST "CM"
 02DF C604      	ADI	004H	;A=D7H,C=0,P=1,S=1,Z=0
 02E1 E8        	RPE		;TEST "RPE"
 02E2 CDA006    	CALL	CPUER
 02E5 F0        CMI:	RP		;TEST "RP"
 02E6 C680      	ADI	080H	;A=39H,C=1,P=1,S=0,Z=0
 02E8 F4F102    	CP	TCPI	;TEST "CP"
 02EB C680      	ADI	080H	;A=D3H,C=0,P=0,S=1,Z=0
 02ED F8        	RM		;TEST "RM"
 02EE CDA006    	CALL	CPUER
 02F1 F8        TCPI:	RM		;TEST "RM"
 02F2 C640      	ADI	040H	;A=79H,C=0,P=0,S=0,Z=0
 02F4 D4FD02    	CNC	CNCI	;TEST "CNC"
 02F7 C640      	ADI	040H	;A=53H,C=0,P=1,S=0,Z=0
 02F9 F0        	RP		;TEST "RP"
 02FA CDA006    	CALL	CPUER
 02FD D8        CNCI:	RC		;TEST "RC"
 02FE C68F      	ADI	08FH	;A=08H,C=1,P=0,S=0,Z=0
 0300 DC0903    	CC	CCI	;TEST "CC"
 0303 D602      	SUI	002H	;A=13H,C=0,P=0,S=0,Z=0
 0305 D0        	RNC		;TEST "RNC"
 0306 CDA006    	CALL	CPUER
 0309 D0        CCI:	RNC		;TEST "RNC"
 030A C6F7      	ADI	0F7H	;A=FFH,C=0,P=1,S=1,Z=0
 030C C41503    	CNZ	CNZI	;TEST "CNZ"
 030F C6FE      	ADI	0FEH	;A=15H,C=1,P=0,S=0,Z=0
 0311 D8        	RC		;TEST "RC"
 0312 CDA006    	CALL	CPUER
 0315 C8        CNZI:	RZ		;TEST "RZ"
 0316 C601      	ADI	001H	;A=00H,C=1,P=1,S=0,Z=1
 0318 CC2103    	CZ	CZI	;TEST "CZ"
 031B C6D0      	ADI	0D0H	;A=17H,C=1,P=1,S=0,Z=0
 031D C0        	RNZ		;TEST "RNZ"
 031E CDA006    	CALL	CPUER
 0321 C0        CZI:	RNZ		;TEST "RNZ"
 0322 C647      	ADI	047H	;A=47H,C=0,P=1,S=0,Z=0
 0324 FE47      	CPI	047H	;A=47H,C=0,P=1,S=0,Z=1
 0326 C8        	RZ		;TEST "RZ"
 0327 CDA006    	CALL	CPUER
                ;
                ;
                ;
                ;TEST "MOV","INR",AND "DCR" INSTRUCTIONS
                ;
 032A 3E77      MOVI:	MVI	A,077H
 032C 3C        	INR	A
 032D 47        	MOV	B,A
 032E 04        	INR	B
 032F 48        	MOV	C,B
 0330 0D        	DCR	C
 0331 51        	MOV	D,C
 0332 5A        	MOV	E,D
 0333 63        	MOV	H,E
 0334 6C        	MOV	L,H
 0335 7D        	MOV	A,L	;TEST "MOV" A,L,H,E,D,C,B,A
 0336 3D        	DCR	A
 0337 4F        	MOV	C,A
 0338 59        	MOV	E,C
 0339 6B        	MOV	L,E
 033A 45        	MOV	B,L
 033B 50        	MOV	D,B
 033C 62        	MOV	H,D
 033D 7C        	MOV	A,H	;TEST "MOV" A,H,D,B,L,E,C,A
 033E 57        	MOV	D,A
 033F 14        	INR	D
 0340 6A        	MOV	L,D
 0341 4D        	MOV	C,L
 0342 0C        	INR	C
 0343 61        	MOV	H,C
 0344 44        	MOV	B,H
 0345 05        	DCR	B
 0346 58        	MOV	E,B
 0347 7B        	MOV	A,E	;TEST "MOV" A,E,B,H,C,L,D,A
 0348 5F        	MOV	E,A
 0349 1C        	INR	E
 034A 43        	MOV	B,E
 034B 60        	MOV	H,B
 034C 24        	INR	H
 034D 4C        	MOV	C,H
 034E 69        	MOV	L,C
 034F 55        	MOV	D,L
 0350 15        	DCR	D
 0351 7A        	MOV	A,D	;TEST "MOV" A,D,L,C,H,B,E,A
 0352 67        	MOV	H,A
 0353 25        	DCR	H
 0354 54        	MOV	D,H
 0355 42        	MOV	B,D
 0356 68        	MOV	L,B
 0357 2C        	INR	L
 0358 5D        	MOV	E,L
 0359 1D        	DCR	E
 035A 4B        	MOV	C,E
 035B 79        	MOV	A,C	;TEST "MOV" A,C,E,L,B,D,H,A
 035C 6F        	MOV	L,A
 035D 2D        	DCR	L
 035E 65        	MOV	H,L
 035F 5C        	MOV	E,H
 0360 53        	MOV	D,E
 0361 4A        	MOV	C,D
 0362 41        	MOV	B,C
 0363 78        	MOV	A,B
 0364 FE77      	CPI	077H
 0366 C4A006    	CNZ	CPUER	;TEST "MOV" A,B,C,D,E,H,L,A
                ;
                ;
                ;
                ;TEST ARITHMETIC AND LOGIC INSTRUCTIONS
                ;
 0369 AF        	XRA	A
 036A 0601      	MVI	B,001H
 036C 0E03      	MVI	C,003H
 036E 1607      	MVI	D,007H
 0370 1E0F      	MVI	E,00FH
 0372 261F      	MVI	H,01FH
 0374 2E3F      	MVI	L,03FH
 0376 80        	ADD	B
 0377 81        	ADD	C
 0378 82        	ADD	D
 0379 83        	ADD	E
 037A 84        	ADD	H
 037B 85        	ADD	L
 037C 87        	ADD	A
 037D FEF0      	CPI	0F0H
 037F C4A006    	CNZ	CPUER	;TEST "ADD" B,C,D,E,H,L,A
 0382 90        	SUB	B
 0383 91        	SUB	C
 0384 92        	SUB	D
 0385 93        	SUB	E
 0386 94        	SUB	H
 0387 95        	SUB	L
 0388 FE78      	CPI	078H
 038A C4A006    	CNZ	CPUER	;TEST "SUB" B,C,D,E,H,L
 038D 97        	SUB	A
 038E C4A006    	CNZ	CPUER	;TEST "SUB" A
 0391 3E80      	MVI	A,080H
 0393 87        	ADD	A
 0394 0601      	MVI	B,001H
 0396 0E02      	MVI	C,002H
 0398 1603      	MVI	D,003H
 039A 1E04      	MVI	E,004H
 039C 2605      	MVI	H,005H
 039E 2E06      	MVI	L,006H
 03A0 88        	ADC	B
 03A1 0680      	MVI	B,080H
 03A3 80        	ADD	B
 03A4 80        	ADD	B
 03A5 89        	ADC	C
 03A6 80        	ADD	B
 03A7 80        	ADD	B
 03A8 8A        	ADC	D
 03A9 80        	ADD	B
 03AA 80        	ADD	B
 03AB 8B        	ADC	E
 03AC 80        	ADD	B
 03AD 80        	ADD	B
 03AE 8C        	ADC	H
 03AF 80        	ADD	B
 03B0 80        	ADD	B
 03B1 8D        	ADC	L
 03B2 80        	ADD	B
 03B3 80        	ADD	B
 03B4 8F        	ADC	A
 03B5 FE37      	CPI	037H
 03B7 C4A006    	CNZ	CPUER	;TEST "ADC" B,C,D,E,H,L,A
 03BA 3E80      	MVI	A,080H
 03BC 87        	ADD	A
 03BD 0601      	MVI	B,001H
 03BF 98        	SBB	B
 03C0 06FF      	MVI	B,0FFH
 03C2 80        	ADD	B
 03C3 99        	SBB	C
 03C4 80        	ADD	B
 03C5 9A        	SBB	D
 03C6 80        	ADD	B
 03C7 9B        	SBB	E
 03C8 80        	ADD	B
 03C9 9C        	SBB	H
 03CA 80        	ADD	B
 03CB 9D        	SBB	L
 03CC FEE0      	CPI	0E0H
 03CE C4A006    	CNZ	CPUER	;TEST "SBB" B,C,D,E,H,L
 03D1 3E80      	MVI	A,080H
 03D3 87        	ADD	A
 03D4 9F        	SBB	A
 03D5 FEFF      	CPI	0FFH
 03D7 C4A006    	CNZ	CPUER	;TEST "SBB" A
 03DA 3EFF      	MVI	A,0FFH
 03DC 06FE      	MVI	B,0FEH
 03DE 0EFC      	MVI	C,0FCH
 03E0 16EF      	MVI	D,0EFH
 03E2 1E7F      	MVI	E,07FH
 03E4 26F4      	MVI	H,0F4H
 03E6 2EBF      	MVI	L,0BFH
 03E8 A0        	ANA	B	;changed from ANA A (mwd)
 03E9 A1        	ANA	C
 03EA A2        	ANA	D
 03EB A3        	ANA	E
 03EC A4        	ANA	H
 03ED A5        	ANA	L
 03EE A7        	ANA	A
 03EF FE24      	CPI	024H
 03F1 C4A006    	CNZ	CPUER	;TEST "ANA" B,C,D,E,H,L,A
 03F4 AF        	XRA	A
 03F5 0601      	MVI	B,001H
 03F7 0E02      	MVI	C,002H
 03F9 1604      	MVI	D,004H
 03FB 1E08      	MVI	E,008H
 03FD 2610      	MVI	H,010H
 03FF 2E20      	MVI	L,020H
 0401 B0        	ORA	B
 0402 B1        	ORA	C
 0403 B2        	ORA	D
 0404 B3        	ORA	E
 0405 B4        	ORA	H
 0406 B5        	ORA	L
 0407 B7        	ORA	A
 0408 FE3F      	CPI	03FH
 040A C4A006    	CNZ	CPUER	;TEST "ORA" B,C,D,E,H,L,A
 040D 3E00      	MVI	A,000H
 040F 268F      	MVI	H,08FH
 0411 2E4F      	MVI	L,04FH
 0413 A8        	XRA	B
 0414 A9        	XRA	C
 0415 AA        	XRA	D
 0416 AB        	XRA	E
 0417 AC        	XRA	H
 0418 AD        	XRA	L
 0419 FECF      	CPI	0CFH
 041B C4A006    	CNZ	CPUER	;TEST "XRA" B,C,D,E,H,L
 041E AF        	XRA	A
 041F C4A006    	CNZ	CPUER	;TEST "XRA" A
 0422 0644      	MVI	B,044H
 0424 0E45      	MVI	C,045H
 0426 1646      	MVI	D,046H
 0428 1E47      	MVI	E,047H
 042A 2606      	MVI	H,(TEMP0 / 0FFH)	;HIGH BYTE OF TEST MEMORY LOCATION
 042C 2EBF      	MVI	L,(TEMP0 AND 0FFH)	;LOW BYTE OF TEST MEMORY LOCATION
 042E 70        	MOV	M,B
 042F 0600      	MVI	B,000H
 0431 46        	MOV	B,M
 0432 3E44      	MVI	A,044H
 0434 B8        	CMP	B
 0435 C4A006    	CNZ	CPUER	;TEST "MOV" M,B AND B,M
 0438 71        	MOV	M,C	;added (mwd)
 0439 0E00      	MVI	C,000H	;added (mwd)
 043B 4E        	MOV	C,M	;added (mwd)
 043C 3E45      	MVI	A,045H	;added (mwd)
 043E B9        	CMP	C	;added (mwd)
 043F C4A006    	CNZ	CPUER	;TEST "MOV" M,C AND C,M	added (mwd)
 0442 72        	MOV	M,D
 0443 1600      	MVI	D,000H
 0445 56        	MOV	D,M
 0446 3E46      	MVI	A,046H
 0448 BA        	CMP	D
 0449 C4A006    	CNZ	CPUER	;TEST "MOV" M,D AND D,M
 044C 73        	MOV	M,E
 044D 1E00      	MVI	E,000H
 044F 5E        	MOV	E,M
 0450 3E47      	MVI	A,047H
 0452 BB        	CMP	E
 0453 C4A006    	CNZ	CPUER	;TEST "MOV" M,E AND E,M
 0456 74        	MOV	M,H
 0457 2606      	MVI	H,(TEMP0 / 0FFH)
 0459 2EBF      	MVI	L,(TEMP0 AND 0FFH)
 045B 66        	MOV	H,M
 045C 3E06      	MVI	A,(TEMP0 / 0FFH)
 045E BC        	CMP	H
 045F C4A006    	CNZ	CPUER	;TEST "MOV" M,H AND H,M
 0462 75        	MOV	M,L
 0463 2606      	MVI	H,(TEMP0 / 0FFH)
 0465 2EBF      	MVI	L,(TEMP0 AND 0FFH)
 0467 6E        	MOV	L,M
 0468 3EBF      	MVI	A,(TEMP0 AND 0FFH)
 046A BD        	CMP	L
 046B C4A006    	CNZ	CPUER	;TEST "MOV" M,L AND L,M
 046E 2606      	MVI	H,(TEMP0 / 0FFH)
 0470 2EBF      	MVI	L,(TEMP0 AND 0FFH)
 0472 3E32      	MVI	A,032H
 0474 77        	MOV	M,A
 0475 BE        	CMP	M
 0476 C4A006    	CNZ	CPUER	;TEST "MOV" M,A
 0479 86        	ADD	M
 047A FE64      	CPI	064H
 047C C4A006    	CNZ	CPUER	;TEST "ADD" M
 047F AF        	XRA	A
 0480 7E        	MOV	A,M
 0481 FE32      	CPI	032H
 0483 C4A006    	CNZ	CPUER	;TEST "MOV" A,M
 0486 2606      	MVI	H,(TEMP0 / 0FFH)
 0488 2EBF      	MVI	L,(TEMP0 AND 0FFH)
 048A 7E        	MOV	A,M
 048B 96        	SUB	M
 048C C4A006    	CNZ	CPUER	;TEST "SUB" M
 048F 3E80      	MVI	A,080H
 0491 87        	ADD	A
 0492 8E        	ADC	M
 0493 FE33      	CPI	033H
 0495 C4A006    	CNZ	CPUER	;TEST "ADC" M
 0498 3E80      	MVI	A,080H
 049A 87        	ADD	A
 049B 9E        	SBB	M
 049C FECD      	CPI	0CDH
 049E C4A006    	CNZ	CPUER	;TEST "SBB" M
 04A1 A6        	ANA	M
 04A2 C4A006    	CNZ	CPUER	;TEST "ANA" M
 04A5 3E25      	MVI	A,025H
 04A7 B6        	ORA	M
 04A8 FE37      	CPI	037H
 04AA C4A006    	CNZ	CPUER	;TEST "ORA" M
 04AD AE        	XRA	M
 04AE FE05      	CPI	005H
 04B0 C4A006    	CNZ	CPUER	;TEST "XRA" M
 04B3 3655      	MVI	M,055H
 04B5 34        	INR	M
 04B6 35        	DCR	M
 04B7 86        	ADD	M
 04B8 FE5A      	CPI	05AH
 04BA C4A006    	CNZ	CPUER	;TEST "INR","DCR",AND "MVI" M
 04BD 01FF12    	LXI	B,12FFH
 04C0 11FF12    	LXI	D,12FFH
 04C3 21FF12    	LXI	H,12FFH
 04C6 03        	INX	B
 04C7 13        	INX	D
 04C8 23        	INX	H
 04C9 3E13      	MVI	A,013H
 04CB B8        	CMP	B
 04CC C4A006    	CNZ	CPUER	;TEST "LXI" AND "INX" B
 04CF BA        	CMP	D
 04D0 C4A006    	CNZ	CPUER	;TEST "LXI" AND "INX" D
 04D3 BC        	CMP	H
 04D4 C4A006    	CNZ	CPUER	;TEST "LXI" AND "INX" H
 04D7 3E00      	MVI	A,000H
 04D9 B9        	CMP	C
 04DA C4A006    	CNZ	CPUER	;TEST "LXI" AND "INX" B
 04DD BB        	CMP	E
 04DE C4A006    	CNZ	CPUER	;TEST "LXI" AND "INX" D
 04E1 BD        	CMP	L
 04E2 C4A006    	CNZ	CPUER	;TEST "LXI" AND "INX" H
 04E5 0B        	DCX	B
 04E6 1B        	DCX	D
 04E7 2B        	DCX	H
 04E8 3E12      	MVI	A,012H
 04EA B8        	CMP	B
 04EB C4A006    	CNZ	CPUER	;TEST "DCX" B
 04EE BA        	CMP	D
 04EF C4A006    	CNZ	CPUER	;TEST "DCX" D
 04F2 BC        	CMP	H
 04F3 C4A006    	CNZ	CPUER	;TEST "DCX" H
 04F6 3EFF      	MVI	A,0FFH
 04F8 B9        	CMP	C
 04F9 C4A006    	CNZ	CPUER	;TEST "DCX" B
 04FC BB        	CMP	E
 04FD C4A006    	CNZ	CPUER	;TEST "DCX" D
 0500 BD        	CMP	L
 0501 C4A006    	CNZ	CPUER	;TEST "DCX" H
 0504 32BF06    	STA	TEMP0
 0507 AF        	XRA	A
 0508 3ABF06    	LDA	TEMP0
 050B FEFF      	CPI	0FFH
 050D C4A006    	CNZ	CPUER	;TEST "LDA" AND "STA"
 0510 2ABD06    	LHLD	TEMPP
 0513 22BF06    	SHLD	TEMP0
 0516 3ABD06    	LDA	TEMPP
 0519 47        	MOV	B,A
 051A 3ABF06    	LDA	TEMP0
 051D B8        	CMP	B
 051E C4A006    	CNZ	CPUER	;TEST "LHLD" AND "SHLD"
 0521 3ABE06    	LDA	TEMPP+1
 0524 47        	MOV	B,A
 0525 3AC006    	LDA	TEMP0+1
 0528 B8        	CMP	B
 0529 C4A006    	CNZ	CPUER	;TEST "LHLD" AND "SHLD"
 052C 3EAA      	MVI	A,0AAH
 052E 32BF06    	STA	TEMP0
 0531 44        	MOV	B,H
 0532 4D        	MOV	C,L
 0533 AF        	XRA	A
 0534 0A        	LDAX	B
 0535 FEAA      	CPI	0AAH
 0537 C4A006    	CNZ	CPUER	;TEST "LDAX" B
 053A 3C        	INR	A
 053B 02        	STAX	B
 053C 3ABF06    	LDA	TEMP0
 053F FEAB      	CPI	0ABH
 0541 C4A006    	CNZ	CPUER	;TEST "STAX" B
 0544 3E77      	MVI	A,077H
 0546 32BF06    	STA	TEMP0
 0549 2ABD06    	LHLD	TEMPP
 054C 110000    	LXI	D,00000H
 054F EB        	XCHG
 0550 AF        	XRA	A
 0551 1A        	LDAX	D
 0552 FE77      	CPI	077H
 0554 C4A006    	CNZ	CPUER	;TEST "LDAX" D AND "XCHG"
 0557 AF        	XRA	A
 0558 84        	ADD	H
 0559 85        	ADD	L
 055A C4A006    	CNZ	CPUER	;TEST "XCHG"
 055D 3ECC      	MVI	A,0CCH
 055F 12        	STAX	D
 0560 3ABF06    	LDA	TEMP0
 0563 FECC      	CPI	0CCH
 0565 12        	STAX	D
 0566 3ABF06    	LDA	TEMP0
 0569 FECC      	CPI	0CCH
 056B C4A006    	CNZ	CPUER	;TEST "STAX" D
 056E 217777    	LXI	H,07777H
 0571 29        	DAD	H
 0572 3EEE      	MVI	A,0EEH
 0574 BC        	CMP	H
 0575 C4A006    	CNZ	CPUER	;TEST "DAD" H
 0578 BD        	CMP	L
 0579 C4A006    	CNZ	CPUER	;TEST "DAD" H
 057C 215555    	LXI	H,05555H
 057F 01FFFF    	LXI	B,0FFFFH
 0582 09        	DAD	B
 0583 3E55      	MVI	A,055H
 0585 D4A006    	CNC	CPUER	;TEST "DAD" B
 0588 BC        	CMP	H
 0589 C4A006    	CNZ	CPUER	;TEST "DAD" B
 058C 3E54      	MVI	A,054H
 058E BD        	CMP	L
 058F C4A006    	CNZ	CPUER	;TEST "DAD" B
 0592 21AAAA    	LXI	H,0AAAAH
 0595 113333    	LXI	D,03333H
 0598 19        	DAD	D
 0599 3EDD      	MVI	A,0DDH
 059B BC        	CMP	H
 059C C4A006    	CNZ	CPUER	;TEST "DAD" D
 059F BD        	CMP	L
 05A0 C4A006    	CNZ	CPUER	;TEST "DAD" B
 05A3 37        	STC
 05A4 D4A006    	CNC	CPUER	;TEST "STC"
 05A7 3F        	CMC
 05A8 DCA006    	CC	CPUER	;TEST "CMC
 05AB 3EAA      	MVI	A,0AAH
 05AD 2F        	CMA	
 05AE FE55      	CPI	055H
 05B0 C4A006    	CNZ	CPUER	;TEST "CMA"
 05B3 B7        	ORA	A	;RE-SET AUXILIARY CARRY
 05B4 27        	DAA
 05B5 FE55      	CPI	055H
 05B7 C4A006    	CNZ	CPUER	;TEST "DAA"
 05BA 3E88      	MVI	A,088H
 05BC 87        	ADD	A
 05BD 27        	DAA
 05BE FE76      	CPI	076H
 05C0 C4A006    	CNZ	CPUER	;TEST "DAA"
 05C3 AF        	XRA	A
 05C4 3EAA      	MVI	A,0AAH
 05C6 27        	DAA
 05C7 D4A006    	CNC	CPUER	;TEST "DAA"
 05CA FE10      	CPI	010H
 05CC C4A006    	CNZ	CPUER	;TEST "DAA"
 05CF AF        	XRA	A
 05D0 3E9A      	MVI	A,09AH
 05D2 27        	DAA
 05D3 D4A006    	CNC	CPUER	;TEST "DAA"
 05D6 C4A006    	CNZ	CPUER	;TEST "DAA"
 05D9 37        	STC
 05DA 3E42      	MVI	A,042H
 05DC 07        	RLC
 05DD DCA006    	CC	CPUER	;TEST "RLC" FOR RE-SET CARRY
 05E0 07        	RLC
 05E1 D4A006    	CNC	CPUER	;TEST "RLC" FOR SET CARRY
 05E4 FE09      	CPI	009H
 05E6 C4A006    	CNZ	CPUER	;TEST "RLC" FOR ROTATION
 05E9 0F        	RRC
 05EA D4A006    	CNC	CPUER	;TEST "RRC" FOR SET CARRY
 05ED 0F        	RRC
 05EE FE42      	CPI	042H
 05F0 C4A006    	CNZ	CPUER	;TEST "RRC" FOR ROTATION
 05F3 17        	RAL
 05F4 17        	RAL
 05F5 D4A006    	CNC	CPUER	;TEST "RAL" FOR SET CARRY
 05F8 FE08      	CPI	008H
 05FA C4A006    	CNZ	CPUER	;TEST "RAL" FOR ROTATION
 05FD 1F        	RAR
 05FE 1F        	RAR
 05FF DCA006    	CC	CPUER	;TEST "RAR" FOR RE-SET CARRY
 0602 FE02      	CPI	002H
 0604 C4A006    	CNZ	CPUER	;TEST "RAR" FOR ROTATION
 0607 013412    	LXI	B,01234H
 060A 11AAAA    	LXI	D,0AAAAH
 060D 215555    	LXI	H,05555H
 0610 AF        	XRA	A
 0611 C5        	PUSH	B
 0612 D5        	PUSH	D
 0613 E5        	PUSH	H
 0614 F5        	PUSH	PSW
 0615 010000    	LXI	B,00000H
 0618 110000    	LXI	D,00000H
 061B 210000    	LXI	H,00000H
 061E 3EC0      	MVI	A,0C0H
 0620 C6F0      	ADI	0F0H
 0622 F1        	POP	PSW
 0623 E1        	POP	H
 0624 D1        	POP	D
 0625 C1        	POP	B
 0626 DCA006    	CC	CPUER	;TEST "PUSH PSW" AND "POP PSW"
 0629 C4A006    	CNZ	CPUER	;TEST "PUSH PSW" AND "POP PSW"
 062C E4A006    	CPO	CPUER	;TEST "PUSH PSW" AND "POP PSW"
 062F FCA006    	CM	CPUER	;TEST "PUSH PSW" AND "POP PSW"
 0632 3E12      	MVI	A,012H
 0634 B8        	CMP	B
 0635 C4A006    	CNZ	CPUER	;TEST "PUSH B" AND "POP B"
 0638 3E34      	MVI	A,034H
 063A B9        	CMP	C
 063B C4A006    	CNZ	CPUER	;TEST "PUSH B" AND "POP B"
 063E 3EAA      	MVI	A,0AAH
 0640 BA        	CMP	D
 0641 C4A006    	CNZ	CPUER	;TEST "PUSH D" AND "POP D"
 0644 BB        	CMP	E
 0645 C4A006    	CNZ	CPUER	;TEST "PUSH D" AND "POP D"
 0648 3E55      	MVI	A,055H
 064A BC        	CMP	H
 064B C4A006    	CNZ	CPUER	;TEST "PUSH H" AND "POP H"
 064E BD        	CMP	L
 064F C4A006    	CNZ	CPUER	;TEST "PUSH H" AND "POP H"
 0652 210000    	LXI	H,00000H
 0655 39        	DAD	SP
 0656 22C406    	SHLD	SAVSTK	;SAVE THE "OLD" STACK-POINTER!
 0659 31C306    	LXI	SP,TEMP4
 065C 3B        	DCX	SP
 065D 3B        	DCX	SP
 065E 33        	INX	SP
 065F 3B        	DCX	SP
 0660 3E55      	MVI	A,055H
 0662 32C106    	STA	TEMP2
 0665 2F        	CMA
 0666 32C206    	STA	TEMP3
 0669 C1        	POP	B
 066A B8        	CMP	B
 066B C4A006    	CNZ	CPUER	;TEST "LXI","DAD","INX",AND "DCX" SP
 066E 2F        	CMA
 066F B9        	CMP	C
 0670 C4A006    	CNZ	CPUER	;TEST "LXI","DAD","INX", AND "DCX" SP
 0673 21C306    	LXI	H,TEMP4
 0676 F9        	SPHL
 0677 213377    	LXI	H,07733H
 067A 3B        	DCX	SP
 067B 3B        	DCX	SP
 067C E3        	XTHL
 067D 3AC206    	LDA	TEMP3
 0680 FE77      	CPI	077H
 0682 C4A006    	CNZ	CPUER	;TEST "SPHL" AND "XTHL"
 0685 3AC106    	LDA	TEMP2
 0688 FE33      	CPI	033H
 068A C4A006    	CNZ	CPUER	;TEST "SPHL" AND "XTHL"
 068D 3E55      	MVI	A,055H
 068F BD        	CMP	L
 0690 C4A006    	CNZ	CPUER	;TEST "SPHL" AND "XTHL"
 0693 2F        	CMA
 0694 BC        	CMP	H
 0695 C4A006    	CNZ	CPUER	;TEST "SPHL" AND "XTHL"
 0698 2AC406    	LHLD	SAVSTK	;RESTORE THE "OLD" STACK-POINTER
 069B F9        	SPHL
 069C 21B406    	LXI	H,CPUOK
 069F E9        	PCHL		;TEST "PCHL"
                ;
                ;
                ;
 06A0 219001    CPUER:	LXI	H,NGCPU	;OUTPUT "CPU HAS FAILED    ERROR EXIT=" TO CONSOLE
 06A3 CD4B01    	CALL	MSG
 06A6 E1        	POP	H	;HL = ADDRESS FOLLOWING CALL CPUER
 06A7 E5        	PUSH	H
 06A8 7C        	MOV	A,H
 06A9 CD5A01    	CALL	BYTEO	;SHOW ERROR EXIT ADDRESS HIGH BYTE
 06AC E1        	POP	H
 06AD 7D        	MOV	A,L
 06AE CD5A01    	CALL	BYTEO	;SHOW ERROR EXIT ADDRESS LOW BYTE
 06B1 C30000    	JMP	WBOOT	;EXIT TO CP/M WARM BOOT
                ;
                ;
                ;
 06B4 217A01    CPUOK:	LXI	H,OKCPU	;OUTPUT "CPU IS OPERATIONAL" TO CONSOLE
 06B7 CD4B01    	CALL	MSG
 06BA C30000    	JMP	WBOOT	;EXIT TO CP/M WARM BOOT
                ;
                ;
                ;
 06BD BF06      TEMPP:	DW	TEMP0	;POINTER USED TO TEST "LHLD","SHLD",
                			; AND "LDAX" INSTRUCTIONS
                ;
 06BF           TEMP0:	DS	1	;TEMPORARY STORAGE FOR CPU TEST MEMORY LOCATIONS
 06C0           TEMP1:	DS	1	;TEMPORARY STORAGE FOR CPU TEST MEMORY LOCATIONS
 06C1           TEMP2	DS	1	;TEMPORARY STORAGE FOR CPU TEST MEMORY LOCATIONS
 06C2           TEMP3:	DS	1	;TEMPORARY STORAGE FOR CPU TEST MEMORY LOCATIONS
 06C3           TEMP4:	DS	1	;TEMPORARY STORAGE FOR CPU TEST MEMORY LOCATIONS
 06C4           SAVSTK:	DS	2	;TEMPORARY STACK-POINTER STORAGE LOCATION
                ;
                ;
                ;
 07BD =         STACK	EQU	TEMPP+256	;DE-BUG STACK POINTER STORAGE AREA
                ;
                ;
                ;
 06C6           	END
